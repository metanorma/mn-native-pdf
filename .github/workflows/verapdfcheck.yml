name: verapdfcheck

on:
  push:
    branches:
      - master
  pull_request:

concurrency:
  group: '${{ github.workflow }}-${{ github.job }}-${{ github.head_ref || github.ref_name }}'
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    outputs:
      common_changed: ${{ steps.common-changed.outputs.only_changed }}
    steps:
              
      - name: Download workflow artifact
        uses: dawidd6/action-download-artifact@v6
        with:
          workflow: ubuntu.yml
          workflow_conclusion: success

      - name: Run Docker image veraPDF
        run: |
          docker pull verapdf/rest:latest
          docker run -d -p 8080:8080 -p 8081:8081 -v ./:/home/folder verapdf/rest:latest
          
      - name: Check PDFs by veraPDF
        run: |
          find ./ -type f -name "*.pdf" -exec curl -F "file=@{}" localhost:8080/api/validate/3a -H "Accept:application/xml" > "{}.verapdf.report.xml" \;
      
      - name: List files
        run:  |
          find ./ -type f -name "*.verapdf.report.xml"
